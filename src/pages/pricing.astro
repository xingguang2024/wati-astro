---
/**
 * Astra Pricing Page
 *
 * Based on tpl-astrapricing.php from WordPress
 * Features:
 * - Hero banner
 * - Monthly/Yearly pricing tabs
 * - Three pricing tiers (Free, Pro, Business)
 * - Add-ons section
 * - Detailed comparison table
 */

import Layout from "../layouts/Layout.astro";
import ColorButton from "../components/ColorButton.astro";
import PricingTabs from "../components/PricingTabs";
import PricingComparisonTable from "../components/PricingComparisonTable";

const title = "Pricing | Astra by Wati - AI Agent Orchestration Platform";
const description =
  "Simple, transparent pricing for Astra AI Agents. Start free or choose a plan that scales with your business.";
---

<Layout title={title} description={description}>
  <!-- Hero Banner -->
  <section
    class="relative pt-32 pb-12 text-center bg-[url('/images/stars.svg')] bg-contain bg-no-repeat bg-top mt-24"
  >
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h1
          class="font-['DM_Sans'] font-extrabold text-5xl md:text-6xl lg:text-[64px] leading-tight text-center mb-8"
        >
          <span
            class="bg-linear-to-b from-[#173DA6] to-[#091840] bg-clip-text text-transparent"
          >
            DELIVER MORE
          </span>
          <br />
          THAN IT COSTS
        </h1>

        <div class="flex flex-wrap items-center justify-center gap-3 mb-12">
          <a
            href="https://astra.wati.io/register/"
            target="_blank"
            rel="noopener"
            class="inline-flex items-center gap-2 bg-[#1A3478] text-white font-semibold text-lg px-6 h-10.5 rounded-lg hover:bg-[#152a5e] transition-colors"
          >
            Get started for free
            <img src="/images/arrowwhite.svg" class="w-4 h-4" />
          </a>
          <button
            id="pricingBookDemoBtn"
            class="inline-flex items-center gap-2 border-2 border-zinc-300 text-zinc-900 font-semibold text-lg px-6 py-3 rounded-lg hover:border-zinc-400 transition-colors relative pr-10"
          >
            Book a demo
            <svg
              width="14"
              height="14"
              viewBox="0 0 14 14"
              fill="none"
              class="absolute right-2 top-1/2 -translate-y-1/2"
            >
              <path
                d="M1 13L13 1M13 1H1M13 1V13"
                stroke="currentColor"
                stroke-width="2"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Pricing Plans Section -->
  <section class="py-16 md:py-24">
    <div class="container mx-auto px-4">
      <PricingTabs client:load />
    </div>
  </section>

  <!-- Add-ons Section -->
  <section class="py-16 md:py-24 bg-zinc-50">
    <div class="container mx-auto px-4">
      <div class="text-center mb-16">
        <ColorButton>Add-ons</ColorButton>
        <h2
          class="font-['DM_Sans'] font-bold text-4xl md:text-5xl text-zinc-900 leading-tight mt-4"
        >
          One size never fits all
        </h2>
        <p class="text-xl md:text-2xl text-zinc-700 mt-4">
          Need more? Customize your plan with additional credits and features.
        </p>
      </div>

      <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
        <!-- Additional Credits -->
        <div class="bg-white rounded-2xl p-8 border border-zinc-200">
          <div
            class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-6"
          >
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 6v6l4 2"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-zinc-900 mb-3">
            Additional Credits
          </h3>
          <p class="text-base text-zinc-700 mb-4">
            Need more conversations? Purchase additional credits as needed.
          </p>
          <ul class="space-y-2 mb-6">
            <li class="flex items-start gap-2 text-sm text-zinc-700">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                viewBox="0 0 12 9"
                fill="none"
              >
                <path
                  d="M1 4L4.5 7.5L11 1"
                  stroke="currentColor"
                  strokeWidth="2"></path>
              </svg>
              1,000 credits: $20/month
            </li>
            <li class="flex items-start gap-2 text-sm text-zinc-700">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                viewBox="0 0 12 9"
                fill="none"
              >
                <path
                  d="M1 4L4.5 7.5L11 1"
                  stroke="currentColor"
                  strokeWidth="2"></path>
              </svg>
              5,000 credits: $80/month
            </li>
            <li class="flex items-start gap-2 text-sm text-zinc-700">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                viewBox="0 0 12 9"
                fill="none"
              >
                <path
                  d="M1 4L4.5 7.5L11 1"
                  stroke="currentColor"
                  strokeWidth="2"></path>
              </svg>
              Custom volume pricing available
            </li>
          </ul>
        </div>

        <!-- Additional Features -->
        <div class="bg-white rounded-2xl p-8 border border-zinc-200">
          <div
            class="w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center mb-6"
          >
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
            >
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-zinc-900 mb-3">Custom Features</h3>
          <p class="text-base text-zinc-700 mb-4">
            Enterprise needs? We'll build a custom solution for you.
          </p>
          <ul class="space-y-2 mb-6">
            <li class="flex items-start gap-2 text-sm text-zinc-700">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                viewBox="0 0 12 9"
                fill="none"
              >
                <path
                  d="M1 4L4.5 7.5L11 1"
                  stroke="currentColor"
                  strokeWidth="2"></path>
              </svg>
              White-label solutions
            </li>
            <li class="flex items-start gap-2 text-sm text-zinc-700">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                viewBox="0 0 12 9"
                fill="none"
              >
                <path
                  d="M1 4L4.5 7.5L11 1"
                  stroke="currentColor"
                  strokeWidth="2"></path>
              </svg>
              Custom integrations
            </li>
            <li class="flex items-start gap-2 text-sm text-zinc-700">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                viewBox="0 0 12 9"
                fill="none"
              >
                <path
                  d="M1 4L4.5 7.5L11 1"
                  stroke="currentColor"
                  strokeWidth="2"></path>
              </svg>
              Dedicated infrastructure
            </li>
          </ul>
        </div>
      </div>

      <div class="text-center mt-12">
        <button
          class="inline-flex items-center gap-2 border-2 border-zinc-300 text-zinc-900 font-semibold text-lg px-8 py-3 rounded-lg hover:border-zinc-400 transition-colors"
          onClick={() =>
            window.dispatchEvent(new CustomEvent("openBookDemoModal"))}
        >
          Contact sales for custom pricing
        </button>
      </div>
    </div>
  </section>

  <!-- Comparison Table Section -->
  <section class="py-12 md:py-32">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <ColorButton>Compare plans</ColorButton>
        <h2
          class="font-['DM_Sans'] font-bold text-4xl md:text-5xl text-zinc-900 mt-4"
        >
          Detailed plan comparison
        </h2>
      </div>

      <PricingComparisonTable client:load />

      <div class="text-center mt-12">
        <a
          href="https://astra.wati.io/register/"
          target="_blank"
          rel="noopener"
          class="inline-flex items-center gap-2 bg-[#1A3478] text-white font-semibold text-lg px-6 h-10.5 rounded-lg hover:bg-[#152a5e] transition-colors"
        >
          Get started for free
          <img src="/images/arrowwhite.svg" class="w-4 h-4" />
        </a>
      </div>
    </div>
  </section>

  <!-- Modal Container -->
  <div id="modal-root"></div>
</Layout>

<script>
  // Book Demo Modal Integration
  import BookDemoModal from "../components/BookDemoModal";
  import CalendlyModal from "../components/CalendlyModal";
  import {
    getCalendlyUrl,
    buildCalendlyUrl,
    getCurrentUrlParams,
  } from "../utils/calendly";

  let bookDemoRoot: any = null;
  let calendlyRoot: any = null;
  let bookDemoModalOpen = false;
  let calendlyModalOpen = false;
  const modalContainer = document.getElementById("modal-root");

  async function renderBookDemoModal(isOpen: boolean, onFormSubmit?: any) {
    if (!modalContainer) return;

    const [{ createRoot }, React] = await Promise.all([
      import("react-dom/client"),
      import("react"),
    ]);

    if (!bookDemoRoot) {
      bookDemoRoot = createRoot(modalContainer);
    }

    bookDemoRoot.render(
      React.createElement(BookDemoModal, {
        isOpen,
        onClose: () => {
          bookDemoModalOpen = false;
          renderBookDemoModal(false);
        },
        onFormSubmit,
      }),
    );
  }

  async function renderCalendlyModal(isOpen: boolean, url: string = "") {
    if (!modalContainer) return;

    const [{ createRoot }, React] = await Promise.all([
      import("react-dom/client"),
      import("react"),
    ]);

    if (!calendlyRoot) {
      const tempDiv = document.createElement("div");
      modalContainer.appendChild(tempDiv);
      calendlyRoot = createRoot(tempDiv);
    }

    calendlyRoot.render(
      React.createElement(CalendlyModal, {
        isOpen,
        calendlyUrl: url,
        onClose: () => {
          calendlyModalOpen = false;
          renderCalendlyModal(false);
        },
      }),
    );
  }

  async function openBookDemoModal() {
    if (bookDemoModalOpen) return;
    bookDemoModalOpen = true;

    await renderBookDemoModal(true, async (formData: any) => {
      console.log("Form submitted with data:", formData);

      const baseUrl = await getCalendlyUrl(
        formData.phone || "",
        formData.email || "",
      );

      const utmParams = getCurrentUrlParams();
      const calendlyUrl = buildCalendlyUrl(baseUrl, formData, utmParams);

      console.log("Opening Calendly:", calendlyUrl);

      bookDemoModalOpen = false;
      await renderBookDemoModal(false);

      setTimeout(() => {
        calendlyModalOpen = true;
        renderCalendlyModal(true, calendlyUrl);
      }, 300);
    });
  }

  // Listen for modal events
  window.addEventListener("openBookDemoModal", openBookDemoModal);

  // Handle page buttons
  const bookDemoBtns = document.querySelectorAll(
    "#pricingBookDemoBtn, .book-demo-trigger",
  );
  bookDemoBtns.forEach((btn) => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      openBookDemoModal();
    });
  });
</script>
